{{define "main"}}
<style>
 /* https://mikejolley.com/2019/08/02/building-a-cross-browser-compatible-multi-handle-range-slider/ */
 .slider {
     margin: 0;
     padding: 0;
     border: 0;
     outline: none;
     background: transparent;
     -webkit-appearance: none;
     -moz-appearance: none;
     width: 100%;
     height: 0;
     pointer-events: none; // Prevent mouse interaction on the range slider.
 }
 .slider::-webkit-slider-runnable-track {
     cursor: default;
     height: 1px; /* Required for Samsung internet based browsers */
     outline: 0;
     -webkit-appearance: none;
     // Add custom styles here..
 }
 .slider::-moz-range-track {
     cursor: default;
     -moz-appearance: none;
     outline: 0;
     height: 1px;
     // Add custom styles here..
 }

 .slider::-webkit-slider-thumb {
     -webkit-appearance: none; // Reset appearance so we can apply backgrounds/borders etc.
     pointer-events: auto; // Re-enable pointer events so the handles can be used.
     width: 50px;
     height: 50px;
     margin-top: -13px;
     border-radius: 50%; 
     background: white;
     opacity: .5;
 }

 .selected .slider::-webkit-slider-thumb {
     background: white;
     opacity: .5;
 }

 .track {
     width: 100%;
     height: 32px;
 }

 .preview {
     width: 100%;
     height: 480px;
     border: 1px solid black;
 }

 .picker {
     background: lightgray;
     padding: 1em;
 }
</style>

{{template "picker" .}}

{{end}}

{{define "picker"}}
<form class="picker" hx-post="/tools/picker" hx-swap="outerHTML">
  <div class="f-row">
    <div class="flex-grow:1"></div>
    <button style="display: none" id="submit"></button>
  </div>

  <div class="f-row align-items:baseline">
    <select
      style="width: 100%"
      name="gradientType"
      _="on change log 'changed' then click() the #submit"
    >
      <option {{if (eq .Gradient.Type "linear")}}selected{{end}} value="linear">Linear Gradient</option>
      <option {{if (eq .Gradient.Type "radial")}}selected{{end}} value="radial">Radial Gradient</option>
      <option {{if (eq .Gradient.Type "conic")}}selected{{end}} value="conic">Conic Gradient</option>
    </select>
    <label style="white-space: nowrap">
      <input
        id="repeatingCheckbox"
        type="checkbox"
        name="repeat"
        _="on change log 'changed' then click() the #submit"
        {{if .Gradient.Repeat}}checked{{end}}
      >
      Repeating
    </label>
  </div>    

  <div class="f-row" style="--gap: 0px">
    {{if (gt (index .Gradient.Stops 0).Percent 0)}}
    <button>-1</button>
    {{end}}

    {{range $i, $e := .Gradient.Stops}}
    <input
      name="color"
      stylex="position: absolute;top:40"
      type="color"
      value="{{.Color}}"
      style="width: 100%"
      _="on change log 'changed' then click() the #submit"
    >
    {{if (lt .Percent 100)}}
    <button>{{$i}}</button>
    {{end}}

    {{end}}
  </div>

  <div style="position:relative">

    {{range .Gradient.Stops}}
    <div class="group">
      <input
        name="percent"
        style="position:absolute"
        type="range"
        min="0"
        max="100"
        value="{{.Percent}}"
        class="slider"
        _="on click remove .selected from .selected add .selected to the closest .group
              on change log 'changed' then click() the #submit"
      >
    </div>
    {{end}}

    <div class="track" style="background: {{.Gradient.RenderBar}}"></div>
  </div>

  <div class="f-row">
    <input
      {{if (eq .Gradient.Type "radial")}}style="visibility: hidden"{{end}}
      name="degrees"
      type="range"
      min="0"
      max="180"
      value="{{.Gradient.Degrees}}"
      _="on change click() the #submit">
  </div>

  <div class="preview" style="background: {{.Gradient.Render}}"></div>

  <div class="f-row justify-content:space-between">
    <code>
      {{.Gradient.Render}}
    </code>

    <button
      class="big"
      hx-post="/tools/set-background"
      hx-target="#user-style"
      hx-swap="innerHTML"
    >
      set as background
    </button>
  </div>

</form>
{{end}}

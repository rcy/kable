{{define "main"}}
<div style="display:flex;flex-direction:column;gap:1em;">

  {{template "card" .}}
  {{template "about" .}}

  {{if (not (eq .User.ID .Layout.User.ID))}}
  <section class="nes-container ghost">
    <a class="nes-btn" href="/u/{{.User.ID}}/chat">chat with {{.User.Username}}</a>
  </section>
  {{end}}
</div>
{{end}}

{{define "edit-section-button"}}
<button hx-get={{.}} hx-target="closest section" class="nes-btn" style="position: absolute; right:4px; top:4px; ">
  edit
</button>
{{end}}

{{define "card"}}
<section id="card" class="nes-container ghost" hx-swap="outerHTML">
  <div style="display: flex; align-items: top; gap: 1em" >
    <figure style="width:80px; height:80px;">
      <img src="https://www.gravatar.com/avatar/YbmqdkSAup84nP3Q3?f=y&d=retro">
    </figure>

    <div style="display: flex; flex-direction: column">
      <h1>{{.User.Username}}</h1>
      <div>Joined {{.User.CreatedAt}}</div>
    </div>
  </div>
  {{if .CanEdit}}{{template "edit-section-button" "/card/edit"}}{{end}}
</section>
{{end}}

{{define "card-edit"}}
<section class="nes-container is-dark" hx-swap="outerHTML" hx-target="closest section">
  <h3>Editing User</h3>

  <form hx-patch="/user" style="display: flex; flex-direction: column; gap: 1em">
    <div class="nes-field xis-inline">
      <label for="username-field">username</label>
      <input id="username-field" class="nes-input" name="username" type="text" value="{{.User.Username}}"/>
    </div>
    <div style="display:flex; justify-content:space-between;">
      <button type="submit" class="nes-btn is-primary">save</button>
      <button type="reset" class="nes-btn" hx-get="" hx-select="#card">cancel</button>
    </div>
  </form>
</section>
{{end}}

{{define "about"}}
<section class="nes-container ghost" hx-swap="outerHTML">
  <h3>About me</h3>
  <p>{{.Bio.Text}}</p>
  {{if .CanEdit}}{{template "edit-section-button" "/bio/edit"}}{{end}}
</section>
{{end}}

{{define "about-edit"}}
<section class="nes-container is-dark" hx-swap="outerHTML">
  <h3>Editing About me</h3>
  <form hx-put="/bio" hx-target="closest section" style="display: flex; flex-direction: column; gap: 1em">
    <textarea
      name="text"
      class="nes-textarea"
      placeholder="Write something here..."
    >{{.Bio.Text}}</textarea>
    <div style="display:flex; justify-content:space-between;">
      <button type="submit" class="nes-btn is-primary">save</button>
      <button type="reset" class="nes-btn" hx-get="/bio">cancel</button>
    </div>
  </form>
</section>
{{end}}
